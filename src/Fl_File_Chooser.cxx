//
// "$Id$"
//
// fltk3::FileChooser dialog for the Fast Light Tool Kit (FLTK).
//
// Copyright 1998-2010 by Bill Spitzak and others.
//
// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Library General Public
// License as published by the Free Software Foundation; either
// version 2 of the License, or (at your option) any later version.
//
// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
// Library General Public License for more details.
//
// You should have received a copy of the GNU Library General Public
// License along with this library; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
// USA.
//
// Please report all bugs and problems on the following page:
//
//     http://www.fltk.org/str.php
//

// generated by Fast Light User Interface Designer (fluid) version 1.0300

#include "../fltk3/FileChooser.h"
#include <fltk3/draw.h>

void fltk3::FileChooser::cb_window_i(fltk3::DoubleWindow*, void*) {
  fileName->value("");
fileList->deselect();
fltk3::remove_timeout((fltk3::TimeoutHandler)previewCB, this);
window->hide();
}
void fltk3::FileChooser::cb_window(fltk3::DoubleWindow* o, void* v) {
  ((fltk3::FileChooser*)(o->user_data()))->cb_window_i(o,v);
}

void fltk3::FileChooser::cb_showChoice_i(fltk3::Choice*, void*) {
  showChoiceCB();
}
void fltk3::FileChooser::cb_showChoice(fltk3::Choice* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->parent()->user_data()))->cb_showChoice_i(o,v);
}

void fltk3::FileChooser::cb_favoritesButton_i(fltk3::MenuButton*, void*) {
  favoritesButtonCB();
}
void fltk3::FileChooser::cb_favoritesButton(fltk3::MenuButton* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->parent()->user_data()))->cb_favoritesButton_i(o,v);
}

void fltk3::FileChooser::cb_newButton_i(fltk3::Button*, void*) {
  newdir();
}
void fltk3::FileChooser::cb_newButton(fltk3::Button* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->parent()->user_data()))->cb_newButton_i(o,v);
}

#include <fltk3/Bitmap.h>
static unsigned char idata_new[] =
{0,0,120,0,132,0,2,1,1,254,1,128,49,128,49,128,253,128,253,128,49,128,49,
128,1,128,1,128,255,255,0,0};
static fltk3::Bitmap image_new(idata_new, 16, 16);

void fltk3::FileChooser::cb__i(fltk3::TiledGroup*, void*) {
  update_preview();
}
void fltk3::FileChooser::cb_(fltk3::TiledGroup* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->user_data()))->cb__i(o,v);
}

void fltk3::FileChooser::cb_fileList_i(fltk3::FileBrowser*, void*) {
  fileListCB();
}
void fltk3::FileChooser::cb_fileList(fltk3::FileBrowser* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->parent()->user_data()))->cb_fileList_i(o,v);
}

void fltk3::FileChooser::cb_previewButton_i(fltk3::CheckButton*, void*) {
  preview(previewButton->value());
}
void fltk3::FileChooser::cb_previewButton(fltk3::CheckButton* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->parent()->parent()->user_data()))->cb_previewButton_i(o,v);
}
#ifndef WIN32
void fltk3::FileChooser::remove_hidden_files()
{
  int count = fileList->size();
  for(int num = count; num >= 1; num--) {
    const char *p = fileList->text(num);
    if (*p == '.' && strcmp(p, "../") != 0) fileList->remove(num);
  }
  fileList->topline(1);
}

void fltk3::FileChooser::show_hidden_cb(fltk3::CheckButton* o, void* data) {
  fltk3::FileChooser *mychooser = (fltk3::FileChooser *)data;
  if (o->value()) {
    mychooser->browser()->load(mychooser->directory());
  } else {
    mychooser->remove_hidden_files();
    mychooser->browser()->redraw();
  }
}
#endif
void fltk3::FileChooser::cb_fileName_i(Fl_File_Input*, void*) {
  fileNameCB();
}
void fltk3::FileChooser::cb_fileName(Fl_File_Input* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->parent()->user_data()))->cb_fileName_i(o,v);
}

void fltk3::FileChooser::cb_okButton_i(fltk3::ReturnButton*, void*) {
  window->hide();

// Do any callback that is registered...
if (callback_)
  (*callback_)(this, data_);
}
void fltk3::FileChooser::cb_okButton(fltk3::ReturnButton* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->parent()->parent()->user_data()))->cb_okButton_i(o,v);
}

void fltk3::FileChooser::cb_cancelButton_i(fltk3::Button*, void*) {
  fileName->value("");
fileList->deselect();
fltk3::remove_timeout((fltk3::TimeoutHandler)previewCB, this);
window->hide();
}
void fltk3::FileChooser::cb_cancelButton(fltk3::Button* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->parent()->parent()->user_data()))->cb_cancelButton_i(o,v);
}

void fltk3::FileChooser::cb_favList_i(fltk3::FileBrowser*, void*) {
  favoritesCB(favList);
}
void fltk3::FileChooser::cb_favList(fltk3::FileBrowser* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->user_data()))->cb_favList_i(o,v);
}

void fltk3::FileChooser::cb_favUpButton_i(fltk3::Button*, void*) {
  favoritesCB(favUpButton);
}
void fltk3::FileChooser::cb_favUpButton(fltk3::Button* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->parent()->user_data()))->cb_favUpButton_i(o,v);
}

void fltk3::FileChooser::cb_favDeleteButton_i(fltk3::Button*, void*) {
  favoritesCB(favDeleteButton);
}
void fltk3::FileChooser::cb_favDeleteButton(fltk3::Button* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->parent()->user_data()))->cb_favDeleteButton_i(o,v);
}

void fltk3::FileChooser::cb_favDownButton_i(fltk3::Button*, void*) {
  favoritesCB(favDownButton);
}
void fltk3::FileChooser::cb_favDownButton(fltk3::Button* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->parent()->user_data()))->cb_favDownButton_i(o,v);
}

void fltk3::FileChooser::cb_favCancelButton_i(fltk3::Button*, void*) {
  favWindow->hide();
}
void fltk3::FileChooser::cb_favCancelButton(fltk3::Button* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->parent()->user_data()))->cb_favCancelButton_i(o,v);
}

void fltk3::FileChooser::cb_favOkButton_i(fltk3::ReturnButton*, void*) {
  favoritesCB(favOkButton);
}
void fltk3::FileChooser::cb_favOkButton(fltk3::ReturnButton* o, void* v) {
  ((fltk3::FileChooser*)(o->parent()->parent()->user_data()))->cb_favOkButton_i(o,v);
}

fltk3::FileChooser::FileChooser(const char *d, const char *p, int t, const char *title) {
  fltk3::Group *prev_current = fltk3::Group::current();
  { window = new fltk3::DoubleWindow(490, 380, "Choose File");
    window->callback((fltk3::Callback*)cb_window, (void*)(this));
    { fltk3::Group* o = new fltk3::Group(10, 10, 470, 25);
      { showChoice = new fltk3::Choice(65, 10, 215, 25, "Show:");
        showChoice->down_box(fltk3::BORDER_BOX);
        showChoice->labelfont(1);
        showChoice->callback((fltk3::Callback*)cb_showChoice);
        fltk3::Group::current()->resizable(showChoice);
        showChoice->label(show_label);
      } // fltk3::Choice* showChoice
      { favoritesButton = new fltk3::MenuButton(290, 10, 155, 25, "Favorites");
        favoritesButton->down_box(fltk3::BORDER_BOX);
        favoritesButton->callback((fltk3::Callback*)cb_favoritesButton);
        favoritesButton->align(fltk3::Align(fltk3::ALIGN_LEFT|fltk3::ALIGN_INSIDE));
        favoritesButton->label(favorites_label);
      } // fltk3::MenuButton* favoritesButton
      { fltk3::Button* o = newButton = new fltk3::Button(455, 10, 25, 25);
        newButton->image(image_new);
        newButton->labelsize(8);
        newButton->callback((fltk3::Callback*)cb_newButton);
        o->tooltip(new_directory_tooltip);
      } // fltk3::Button* newButton
      o->end();
    } // fltk3::Group* o
    { fltk3::TiledGroup* o = new fltk3::TiledGroup(10, 45, 470, 225);
      o->callback((fltk3::Callback*)cb_);
      { fileList = new fltk3::FileBrowser(10, 45, 295, 225);
        fileList->type(2);
        fileList->callback((fltk3::Callback*)cb_fileList);
        fileList->window()->hotspot(fileList);
      } // fltk3::FileBrowser* fileList
      { previewBox = new fltk3::Box(305, 45, 175, 225, "?");
        previewBox->box(fltk3::DOWN_BOX);
        previewBox->labelsize(100);
        previewBox->align(fltk3::Align(fltk3::ALIGN_CLIP|fltk3::ALIGN_INSIDE));
      } // fltk3::Box* previewBox
      o->end();
      fltk3::Group::current()->resizable(o);
    } // fltk3::TiledGroup* o
    { fltk3::Group* o = new fltk3::Group(10, 275, 470, 95);
      { fltk3::Group* o = new fltk3::Group(10, 275, 470, 20);
        { previewButton = new fltk3::CheckButton(10, 275, 73, 20, "Preview");
          previewButton->shortcut(0x80070);
          previewButton->down_box(fltk3::DOWN_BOX);
          previewButton->value(1);
          previewButton->callback((fltk3::Callback*)cb_previewButton);
          previewButton->label(preview_label);
        } // fltk3::CheckButton* previewButton
#ifndef WIN32	
        { show_hidden = new fltk3::CheckButton(
	    previewButton->x() + previewButton->w() + 30, 275, 140, 20, "Show hidden files");
          show_hidden->down_box(fltk3::DOWN_BOX);
          show_hidden->value(0);
          show_hidden->callback((fltk3::Callback*)show_hidden_cb, this);
          show_hidden->label(hidden_label);
        } // fltk3::CheckButton* show_hidden
#endif	
        { fltk3::Box* o = new fltk3::Box(115, 275, 365, 20);
          fltk3::Group::current()->resizable(o);
        } // fltk3::Box* o
        o->end();
      } // fltk3::Group* o
      { fileName = new Fl_File_Input(115, 300, 365, 35);
        fileName->labelfont(1);
        fileName->callback((fltk3::Callback*)cb_fileName);
        fileName->when(fltk3::WHEN_ENTER_KEY);
        fltk3::Group::current()->resizable(fileName);
        fileName->when(fltk3::WHEN_CHANGED | fltk3::WHEN_ENTER_KEY);
      } // Fl_File_Input* fileName
      { fltk3::Box* o = new fltk3::Box(10, 310, 105, 25, "Filename:");
        o->labelfont(1);
        o->align(fltk3::Align(fltk3::ALIGN_RIGHT|fltk3::ALIGN_INSIDE));
        o->label(filename_label);
      } // fltk3::Box* o
      { fltk3::Group* o = new fltk3::Group(10, 345, 470, 25);
        { okButton = new fltk3::ReturnButton(313, 345, 85, 25, "OK");
          okButton->callback((fltk3::Callback*)cb_okButton);
          okButton->label(fltk3::ok);
        } // fltk3::ReturnButton* okButton
        { fltk3::Button* o = cancelButton = new fltk3::Button(408, 345, 72, 25, "Cancel");
          cancelButton->callback((fltk3::Callback*)cb_cancelButton);
          o->label(fltk3::cancel);
        } // fltk3::Button* cancelButton
        { fltk3::Box* o = new fltk3::Box(10, 345, 30, 25);
          fltk3::Group::current()->resizable(o);
        } // fltk3::Box* o
        o->end();
      } // fltk3::Group* o
      o->end();
    } // fltk3::Group* o
    if (title) window->label(title);
    window->set_modal();
    window->end();
  } // fltk3::DoubleWindow* window
  { favWindow = new fltk3::DoubleWindow(355, 150, "Manage Favorites");
    favWindow->user_data((void*)(this));
    { favList = new fltk3::FileBrowser(10, 10, 300, 95);
      favList->type(2);
      favList->callback((fltk3::Callback*)cb_favList);
      fltk3::Group::current()->resizable(favList);
    } // fltk3::FileBrowser* favList
    { fltk3::Group* o = new fltk3::Group(320, 10, 25, 95);
      { favUpButton = new fltk3::Button(320, 10, 25, 25, "@8>");
        favUpButton->callback((fltk3::Callback*)cb_favUpButton);
      } // fltk3::Button* favUpButton
      { favDeleteButton = new fltk3::Button(320, 45, 25, 25, "X");
        favDeleteButton->labelfont(1);
        favDeleteButton->callback((fltk3::Callback*)cb_favDeleteButton);
        fltk3::Group::current()->resizable(favDeleteButton);
      } // fltk3::Button* favDeleteButton
      { favDownButton = new fltk3::Button(320, 80, 25, 25, "@2>");
        favDownButton->callback((fltk3::Callback*)cb_favDownButton);
      } // fltk3::Button* favDownButton
      o->end();
    } // fltk3::Group* o
    { fltk3::Group* o = new fltk3::Group(10, 113, 335, 29);
      { favCancelButton = new fltk3::Button(273, 115, 72, 25, "Cancel");
        favCancelButton->callback((fltk3::Callback*)cb_favCancelButton);
        favCancelButton->label(fltk3::cancel);
      } // fltk3::Button* favCancelButton
      { favOkButton = new fltk3::ReturnButton(181, 115, 79, 25, "Save");
        favOkButton->callback((fltk3::Callback*)cb_favOkButton);
        favOkButton->label(save_label);
      } // fltk3::ReturnButton* favOkButton
      { fltk3::Box* o = new fltk3::Box(10, 115, 161, 25);
        fltk3::Group::current()->resizable(o);
      } // fltk3::Box* o
      o->end();
    } // fltk3::Group* o
    favWindow->label(manage_favorites_label);
    favWindow->set_modal();
    favWindow->size_range(181, 150);
    favWindow->end();
  } // fltk3::DoubleWindow* favWindow
  callback_ = 0;
data_ = 0;
directory_[0] = 0;
window->size_range(window->w(), window->h(), fltk3::w(), fltk3::h());
type(t);
filter(p);
update_favorites();
value(d);
type(t);
int e;
prefs_.get("preview", e, 1);
preview(e);
fltk3::Group::current(prev_current);
  ext_group=(fltk3::Widget*)0;
}

fltk3::FileChooser::~FileChooser() {
  fltk3::remove_timeout((fltk3::TimeoutHandler)previewCB, this);
if(ext_group)window->remove(ext_group);
delete window;
delete favWindow;
}

void fltk3::FileChooser::callback(void (*cb)(fltk3::FileChooser *, void *), void *d ) {
  callback_ = cb;
data_     = d;
}

void fltk3::FileChooser::color(fltk3::Color c) {
  fileList->color(c);
}

fltk3::Color fltk3::FileChooser::color() {
  return (fileList->color());
}

char * fltk3::FileChooser::directory() {
  return directory_;
}

const char * fltk3::FileChooser::filter() {
  return (fileList->filter());
}

int fltk3::FileChooser::filter_value() {
  return showChoice->value();
}

void fltk3::FileChooser::filter_value(int f) {
  showChoice->value(f);
showChoiceCB();
}

void fltk3::FileChooser::hide() {
  window->hide();
}

void fltk3::FileChooser::iconsize(uchar s) {
  fileList->iconsize(s);
}

uchar fltk3::FileChooser::iconsize() {
  return (fileList->iconsize());
}

void fltk3::FileChooser::label(const char *l) {
  window->label(l);
}

const char * fltk3::FileChooser::label() {
  return (window->label());
}

void fltk3::FileChooser::ok_label(const char *l) {
  okButton->label(l);
int w=0, h=0;
okButton->measure_label(w, h);
okButton->resize(cancelButton->x() - 50 - w, cancelButton->y(),
                 w + 40, 25);
okButton->parent()->init_sizes();
}

const char * fltk3::FileChooser::ok_label() {
  return (okButton->label());
}

void fltk3::FileChooser::show() {
  window->hotspot(fileList);
window->show();
fltk3::flush();
fltk3::cursor(fltk3::CURSOR_WAIT);
rescan_keep_filename();
fltk3::cursor(fltk3::CURSOR_DEFAULT);
fileName->take_focus();
}

int fltk3::FileChooser::shown() {
  return window->shown();
}

void fltk3::FileChooser::textcolor(fltk3::Color c) {
  fileList->textcolor(c);
}

fltk3::Color fltk3::FileChooser::textcolor() {
  return (fileList->textcolor());
}

void fltk3::FileChooser::textfont(fltk3::Font f) {
  fileList->textfont(f);
}

fltk3::Font fltk3::FileChooser::textfont() {
  return (fileList->textfont());
}

void fltk3::FileChooser::textsize(fltk3::Fontsize s) {
  fileList->textsize(s);
}

fltk3::Fontsize fltk3::FileChooser::textsize() {
  return (fileList->textsize());
}

void fltk3::FileChooser::type(int t) {
  type_ = t;
if (t & MULTI)
  fileList->type(fltk3::MULTI_BROWSER);
else
  fileList->type(fltk3::HOLD_BROWSER);
if (t & CREATE)
  newButton->activate();
else
  newButton->deactivate();
if (t & DIRECTORY)
  fileList->filetype(fltk3::FileBrowser::DIRECTORIES);
else
  fileList->filetype(fltk3::FileBrowser::FILES);
}

int fltk3::FileChooser::type() {
  return (type_);
}

void * fltk3::FileChooser::user_data() const {
  return (data_);
}

void fltk3::FileChooser::user_data(void *d) {
  data_ = d;
}

int fltk3::FileChooser::visible() {
  return window->visible();
}

fltk3::Widget* fltk3::FileChooser::add_extra(fltk3::Widget* gr) {
  fltk3::Widget* ret=ext_group;
  if (gr==ext_group) {
    return ret;
      }
      if (ext_group) {
        int sh=ext_group->h()+4;
fltk3::Widget* svres=window->resizable();
window->resizable(NULL);
window->size(window->w(),window->h()-sh);
window->remove(ext_group);
ext_group=NULL;
window->resizable(svres);
          }
          if (gr) {
            int nh=window->h()+gr->h()+4;
fltk3::Widget* svres=window->resizable();
window->resizable(NULL);
window->size(window->w(),nh);
gr->position(2,okButton->y()+okButton->h()+2);
window->add(gr);
ext_group=gr;
window->resizable(svres);
              }
              return ret;
}

//
// End of "$Id$".
//
